<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Name Search</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
        }

        input[type="range"] {
            width: 80%;
            margin-bottom: 10px;
        }

        input[type="text"] {
            padding: 10px;
            width: 200px;
            margin-right: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        button {
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #0056b3;
        }

        .container {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            width: 100%;
            flex-wrap: wrap;
        }

        .box {
            background: skyblue;
            color: white;
            text-align: center;
            padding: 20px;
            width: 120px;
            height: 120px;
            border-radius: 10px;
            margin: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .box.female {
            background: pink;
        }

        .title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        canvas {
            margin-top: 20px;
            width: 80% !important;
            max-width: 600px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Name Search</h1>
    <input type="range" min="1880" max="2023" value="2023" id="yr">
    <span id="rng">2023</span>
    <div>
        <input id="text" placeholder="Enter a name">
        <button id="btn">Search</button>
    </div>
    <div class="container">
        <div class="box" id="M">
            <span class="title">Male</span>
            <span id="nam"></span>
            <span id="numm"></span>
        </div>
        <div class="box female" id="F">
            <span class="title">Female</span>
            <span id="naf"></span>
            <span id="numf"></span>
        </div>
    </div>
    <canvas id="nameChart"></canvas>

    <script>
        function sortNamesByGender(yearData) {
            var maleNames = [];
            var femaleNames = [];

            for (var i = 0; i < yearData.length; i++) {
                var item = yearData[i].split(',');
                var name = item[0];
                var gender = item[1];
                var number = parseInt(item[2]);

                if (gender === 'M') {
                    maleNames.push([name, number]);
                } else if (gender === 'F') {
                    femaleNames.push([name, number]);
                }
            }

            return {
                maleNames: maleNames,
                femaleNames: femaleNames
            };
        }

        var data = [
            [2020, "Olivia,F,1200", "Noah,M,100", "Olivia,M,11", "Texas,F,5"],
            [2021, "Olivia,F,1201", "Noah,M,100", "Olivia,M,10", "Texas,F,6"],
            [2022, "Olivia,F,121", "Noah,M,10"],
            [2023, "Olivia,F,1200", "Noah,M,100", "Olivia,M,11", "Texas,F,5"]
        ];

        var searchName = "";

        function updateResults() {
            var currentYear = parseInt(document.getElementById('yr').value);
            var yearData = [];

            for (var j = 0; j < data.length; j++) {
                if (data[j][0] === currentYear) {
                    yearData = data[j].slice(1);
                    break;
                }
            }

            var result = sortNamesByGender(yearData);
            var mNames = result.maleNames;
            var fNames = result.femaleNames;

            setRandomPlaceholder(mNames, fNames);
            displayResults(mNames, fNames);
            createChart(); // Create a new chart each time
        }

        function setRandomPlaceholder(mNames, fNames) {
            var allNames = mNames.concat(fNames);
            if (allNames.length > 0) {
                var randomIndex = Math.floor(Math.random() * allNames.length);
                var randomName = allNames[randomIndex][0];
                document.getElementById("text").placeholder = randomName;
            }
        }

        function displayResults(mNames, fNames) {
            var mres = "<5";
            var fres = "<5";

            for (var i = 0; i < mNames.length; i++) {
                if (mNames[i][0].toLowerCase() === searchName) {
                    mres = mNames[i][1];
                    break;
                }
            }

            for (var i = 0; i < fNames.length; i++) {
                if (fNames[i][0].toLowerCase() === searchName) {
                    fres = fNames[i][1];
                    break;
                }
            }

            document.getElementById("nam").textContent = searchName || "No name entered";
            document.getElementById("numm").textContent = mres;
            document.getElementById("naf").textContent = searchName || "No name entered";
            document.getElementById("numf").textContent = fres;
        }

        function createChart() {
            var labels = [];
            var maleData = [];
            var femaleData = [];

            for (var j = 0; j < data.length; j++) {
                labels.push(data[j][0]);
                var yearData = sortNamesByGender(data[j].slice(1));
                maleData.push(getTotalNames(yearData.maleNames));
                femaleData.push(getTotalNames(yearData.femaleNames));
            }

            var ctx = document.getElementById('nameChart').getContext('2d');

            // Clear previous chart if it exists
            if (window.nameChart) {
                window.nameChart.destroy();
            }

            window.nameChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Male Names',
                        data: maleData,
                        borderColor: 'blue',
                        fill: false,
                        borderWidth: 2
                    }, {
                        label: 'Female Names',
                        data: femaleData,
                        borderColor: 'pink',
                        fill: false,
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Number of Names'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Year'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Popularity of Names Over the Years'
                        }
                    }
                }
            });
        }

        function getTotalNames(namesArray) {
            var total = 0;
            for (var i = 0; i < namesArray.length; i++) {
                total += namesArray[i][1];
            }
            return total;
        }

        document.getElementById('yr').addEventListener("input", function() {
            document.getElementById("rng").textContent = document.getElementById('yr').value;
            updateResults();
        });

        document.getElementById("btn").addEventListener("click", function() {
            searchName = document.getElementById("text").value.toLowerCase();
            if (!searchName) {
                alert("Please enter a name to search.");
                return;
            }
            updateResults(); // Update results when search button is pressed
        });

        // Initialize display for the default year
        updateResults();
    </script>
</body>
</html>
